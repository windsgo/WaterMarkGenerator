<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Exiv2: geotag.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="exiv2.png"/></td>
  <td id="projectalign">
   <div id="projectname">Exiv2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">geotag.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Reads GPX data and updates images with GPS Tags</p>
<div class="fragment"><div class="line"><span class="comment">// SPDX-License-Identifier: GPL-2.0-or-later</span></div>
<div class="line"><span class="comment">// Sample program to read gpx files and update images with GPS tags</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;expat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;exiv2/exiv2.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if __has_include(&lt;filesystem&gt;)</span></div>
<div class="line"><span class="preprocessor">#include &lt;filesystem&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>fs = std::filesystem;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &lt;experimental/filesystem&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>fs = std::experimental::filesystem;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><span class="preprocessor">#include &lt;windows.h&gt;</span></div>
<div class="line"><span class="keywordtype">char</span>* realpath(<span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">char</span>* path);</div>
<div class="line"><span class="preprocessor">#define lstat stat</span></div>
<div class="line"><span class="preprocessor">#if _MSC_VER &lt; 1400</span></div>
<div class="line"><span class="preprocessor">#define strcpy_s(d, l, s) strcpy(d, s)</span></div>
<div class="line"><span class="preprocessor">#define strcat_s(d, l, s) strcat(d, s)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !defined(_MSC_VER)</span></div>
<div class="line"><span class="preprocessor">#include &lt;dirent.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/param.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#define stricmp strcasecmp</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef _MAX_PATH</span></div>
<div class="line"><span class="preprocessor">#define _MAX_PATH 1024</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// prototypes</span></div>
<div class="line"><span class="keyword">class </span>Options;</div>
<div class="line"><span class="keywordtype">int</span> getFileType(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, Options&amp; options);</div>
<div class="line"><span class="keywordtype">int</span> getFileType(std::string&amp; path, Options&amp; options);</div>
<div class="line"> </div>
<div class="line">std::string getExifTime(time_t t);</div>
<div class="line">time_t parseTime(<span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keywordtype">bool</span> bAdjust = <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordtype">int</span> timeZoneAdjust();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Command-line parser</span></div>
<div class="line"><span class="keyword">class </span>Options {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">bool</span> verbose{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">bool</span> help{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code hl_function" href="namespaceExiv2.html#a2019ba1f82453a4f43d24d12fb63e3e7">version</a>{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">bool</span> dst{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">bool</span> dryrun{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">bool</span> ascii{<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line">  Options() = <span class="keywordflow">default</span>;</div>
<div class="line">  <span class="keyword">virtual</span> ~Options() = <span class="keywordflow">default</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> { resultOK = 0, resultSyntaxError, resultSelectFailed };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span>  <span class="comment">// keyword indices</span></div>
<div class="line">{</div>
<div class="line">  kwHELP = 0,</div>
<div class="line">  kwVERSION,</div>
<div class="line">  kwDST,</div>
<div class="line">  kwDRYRUN,</div>
<div class="line">  kwASCII,</div>
<div class="line">  kwVERBOSE,</div>
<div class="line">  kwADJUST,</div>
<div class="line">  kwTZ,</div>
<div class="line">  kwDELTA,</div>
<div class="line">  kwMAX  <span class="comment">// manages keyword array</span></div>
<div class="line">  ,</div>
<div class="line">  kwNEEDVALUE  <span class="comment">// bogus keywords for error reporting</span></div>
<div class="line">  ,</div>
<div class="line">  kwSYNTAX  <span class="comment">// -- ditto --</span></div>
<div class="line">  ,</div>
<div class="line">  kwNOVALUE = -kwVERBOSE  <span class="comment">// keywords &lt;= kwNOVALUE are flags (no value needed)</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// file types supported</span></div>
<div class="line"><span class="keyword">enum</span> {</div>
<div class="line">  typeUnknown = 0,</div>
<div class="line">  typeDirectory = 1,</div>
<div class="line">  typeImage = 2,</div>
<div class="line">  typeXML = 3,</div>
<div class="line">  typeFile = 4,</div>
<div class="line">  typeDoc = 5,</div>
<div class="line">  typeCode = 6,</div>
<div class="line">  typeMax = 7</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// forward declaration</span></div>
<div class="line"><span class="keyword">class </span>Position;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// globals</span></div>
<div class="line"><span class="keyword">using </span>TimeDict_t = std::map&lt;time_t, Position&gt;;</div>
<div class="line"><span class="keyword">using </span>TimeDict_i = std::map&lt;time_t, Position&gt;::iterator;</div>
<div class="line"><span class="keyword">using </span>strings_t = std::vector&lt;std::string&gt;;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* gDeg = <span class="keyword">nullptr</span>;  <span class="comment">// string &quot;°&quot; or &quot;deg&quot;</span></div>
<div class="line">TimeDict_t gTimeDict;</div>
<div class="line">strings_t gFiles;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Position (from gpx file)</span></div>
<div class="line"><span class="keyword">class </span>Position {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  Position(time_t time, <span class="keywordtype">double</span> lat, <span class="keywordtype">double</span> lon, <span class="keywordtype">double</span> ele) : time_(<a class="code hl_enumvalue" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>), lon_(lon), lat_(lat), ele_(ele) {</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  Position() = <span class="keywordflow">default</span>;</div>
<div class="line">  <span class="keyword">virtual</span> ~Position() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//  instance methods</span></div>
<div class="line">  [[nodiscard]] <span class="keywordtype">bool</span> good()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> time_ || lon_ || lat_ || ele_;</div>
<div class="line">  }</div>
<div class="line">  std::string getTimeString() {</div>
<div class="line">    <span class="keywordflow">if</span> (times_.empty())</div>
<div class="line">      times_ = getExifTime(time_);</div>
<div class="line">    <span class="keywordflow">return</span> times_;</div>
<div class="line">  }</div>
<div class="line">  [[nodiscard]] time_t getTime()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> time_;</div>
<div class="line">  }</div>
<div class="line">  [[nodiscard]] std::string toString() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//  getters/setters</span></div>
<div class="line">  [[nodiscard]] <span class="keywordtype">double</span> lat()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> lat_;</div>
<div class="line">  }</div>
<div class="line">  [[nodiscard]] <span class="keywordtype">double</span> lon()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> lon_;</div>
<div class="line">  }</div>
<div class="line">  [[nodiscard]] <span class="keywordtype">double</span> ele()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> ele_;</div>
<div class="line">  }</div>
<div class="line">  [[nodiscard]] <span class="keywordtype">int</span> delta()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> delta_;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> delta(<span class="keywordtype">int</span> delta) {</div>
<div class="line">    delta_ = delta;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//  data</span></div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  time_t time_{0};</div>
<div class="line">  <span class="keywordtype">double</span> lon_{0.0};</div>
<div class="line">  <span class="keywordtype">double</span> lat_{0.0};</div>
<div class="line">  <span class="keywordtype">double</span> ele_{0.0};</div>
<div class="line">  std::string times_;</div>
<div class="line">  <span class="keywordtype">int</span> delta_{0};</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// public static data</span></div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> adjust_;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> tz_;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> dst_;</div>
<div class="line">  <span class="keyword">static</span> time_t deltaMax_;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// public static member functions</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> Adjust() {</div>
<div class="line">    <span class="keywordflow">return</span> Position::adjust_ + Position::tz_ + Position::dst_;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> tz() {</div>
<div class="line">    <span class="keywordflow">return</span> tz_;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> dst() {</div>
<div class="line">    <span class="keywordflow">return</span> dst_;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> adjust() {</div>
<div class="line">    <span class="keywordflow">return</span> adjust_;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> std::string toExifString(<span class="keywordtype">double</span> d, <span class="keywordtype">bool</span> bRational, <span class="keywordtype">bool</span> bLat);</div>
<div class="line">  <span class="keyword">static</span> std::string toExifString(<span class="keywordtype">double</span> d);</div>
<div class="line">  <span class="keyword">static</span> std::string toExifTimeStamp(std::string&amp; t);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">std::string Position::toExifTimeStamp(std::string&amp; t) {</div>
<div class="line">  <span class="keywordtype">char</span> result[200];</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* arg = t.c_str();</div>
<div class="line">  <span class="keywordtype">int</span> HH = 0;</div>
<div class="line">  <span class="keywordtype">int</span> mm = 0;</div>
<div class="line">  <span class="keywordtype">int</span> SS1 = 0;</div>
<div class="line">  <span class="keywordflow">if</span> (strstr(arg, <span class="stringliteral">&quot;:&quot;</span>) || strstr(arg, <span class="stringliteral">&quot;-&quot;</span>)) {</div>
<div class="line">    <span class="keywordtype">int</span> YY = 0, MM = 0, DD = 0;</div>
<div class="line">    <span class="keywordtype">char</span> a = 0, b = 0, c = 0, d = 0, e = 0;</div>
<div class="line">    sscanf(arg, <span class="stringliteral">&quot;%d%c%d%c%d%c%d%c%d%c%d&quot;</span>, &amp;YY, &amp;a, &amp;MM, &amp;b, &amp;DD, &amp;c, &amp;HH, &amp;d, &amp;mm, &amp;e, &amp;SS1);</div>
<div class="line">  }</div>
<div class="line">  snprintf(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%d/1 %d/1 %d/1&quot;</span>, HH, mm, SS1);</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string Position::toExifString(<span class="keywordtype">double</span> d) {</div>
<div class="line">  <span class="keywordtype">char</span> result[200];</div>
<div class="line">  d *= 100;</div>
<div class="line">  snprintf(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%d/100&quot;</span>, <a class="code hl_function" href="namespaceSafe.html#aaeb8f2b9981d065ea3aa58429cfbfee4">abs</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(d)));</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string Position::toExifString(<span class="keywordtype">double</span> d, <span class="keywordtype">bool</span> bRational, <span class="keywordtype">bool</span> bLat) {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* NS = d &gt;= 0.0 ? <span class="stringliteral">&quot;N&quot;</span> : <span class="stringliteral">&quot;S&quot;</span>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* EW = d &gt;= 0.0 ? <span class="stringliteral">&quot;E&quot;</span> : <span class="stringliteral">&quot;W&quot;</span>;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* NSEW = bLat ? NS : EW;</div>
<div class="line">  <span class="keywordflow">if</span> (d &lt; 0)</div>
<div class="line">    d = -d;</div>
<div class="line">  <span class="keyword">auto</span> deg = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(d);</div>
<div class="line">  d -= deg;</div>
<div class="line">  d *= 60;</div>
<div class="line">  <span class="keyword">auto</span> min = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(d);</div>
<div class="line">  d -= min;</div>
<div class="line">  d *= 60;</div>
<div class="line">  <span class="keyword">auto</span> sec = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(d);</div>
<div class="line">  <span class="keywordtype">char</span> result[200];</div>
<div class="line">  <span class="keywordflow">if</span> (bRational)</div>
<div class="line">    snprintf(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%d/1 %d/1 %d/1&quot;</span>, deg, min, sec);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    snprintf(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%03d%s%02d&#39;%02d\&quot;%s&quot;</span>, deg, gDeg, min, sec, NSEW);</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string Position::toString()<span class="keyword"> const </span>{</div>
<div class="line">  <span class="keywordtype">char</span> result[200];</div>
<div class="line">  std::string sLat = Position::toExifString(lat_, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">  std::string sLon = Position::toExifString(lon_, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line">  snprintf(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%s %s %-8.3f&quot;</span>, sLon.c_str(), sLat.c_str(), ele_);</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// defaults</span></div>
<div class="line"><span class="keywordtype">int</span> Position::adjust_ = 0;</div>
<div class="line"><span class="keywordtype">int</span> Position::tz_ = timeZoneAdjust();</div>
<div class="line"><span class="keywordtype">int</span> Position::dst_ = 0;</div>
<div class="line">time_t Position::deltaMax_ = 60;</div>
<div class="line"></div>
<div class="line"><span class="comment">// UserData - used by XML Parser</span></div>
<div class="line"><span class="keyword">struct </span>UserData final {</div>
<div class="line">  <span class="keyword">explicit</span> UserData(Options&amp; options) : options_(options) {</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//  public data members</span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_function" href="namespaceExiv2_1_1Internal.html#ad1028d0d234befbd6cf52b949236db8f">indent</a>{0};</div>
<div class="line">  <span class="keywordtype">size_t</span> count{0};</div>
<div class="line">  Position now;</div>
<div class="line">  Position prev;</div>
<div class="line">  <span class="keywordtype">int</span> nTrkpt{0};</div>
<div class="line">  <span class="keywordtype">bool</span> bTime{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">bool</span> bEle{<span class="keyword">false</span>};</div>
<div class="line">  <span class="keywordtype">double</span> ele{0.};</div>
<div class="line">  <span class="keywordtype">double</span> lat{0.};</div>
<div class="line">  <span class="keywordtype">double</span> lon{0.};</div>
<div class="line">  std::string xmlt;</div>
<div class="line">  std::string exift;</div>
<div class="line">  time_t <a class="code hl_enumvalue" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>{0};</div>
<div class="line">  Options&amp; options_;</div>
<div class="line">  <span class="comment">// static public data members</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// XML Parser Callbacks</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> startElement(<span class="keywordtype">void</span>* userData, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> <span class="keywordtype">char</span>** atts) {</div>
<div class="line">  <span class="keyword">auto</span> me = <span class="keyword">static_cast&lt;</span>UserData*<span class="keyword">&gt;</span>(userData);</div>
<div class="line">  <span class="comment">// for ( int i = 0 ; i &lt; me-&gt;indent ; i++ ) printf(&quot; &quot;);</span></div>
<div class="line">  <span class="comment">// printf(&quot;begin %s\n&quot;,name);</span></div>
<div class="line">  me-&gt;bTime = strcmp(name, <span class="stringliteral">&quot;time&quot;</span>) == 0;</div>
<div class="line">  me-&gt;bEle = strcmp(name, <span class="stringliteral">&quot;ele&quot;</span>) == 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;trkpt&quot;</span>) == 0) {</div>
<div class="line">    me-&gt;nTrkpt++;</div>
<div class="line">    <span class="keywordflow">while</span> (*atts) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span>* a = atts[0];</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span>* v = atts[1];</div>
<div class="line">      <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;lat&quot;</span>))</div>
<div class="line">        me-&gt;lat = atof(v);</div>
<div class="line">      <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;lon&quot;</span>))</div>
<div class="line">        me-&gt;lon = atof(v);</div>
<div class="line">      atts += 2;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  me-&gt;count++;</div>
<div class="line">  me-&gt;indent++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> endElement(<span class="keywordtype">void</span>* userData, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {</div>
<div class="line">  <span class="keyword">auto</span> me = <span class="keyword">static_cast&lt;</span>UserData*<span class="keyword">&gt;</span>(userData);</div>
<div class="line">  me-&gt;indent--;</div>
<div class="line">  <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;trkpt&quot;</span>) == 0) {</div>
<div class="line">    me-&gt;nTrkpt--;</div>
<div class="line">    me-&gt;now = Position(me-&gt;time, me-&gt;lat, me-&gt;lon, me-&gt;ele);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!me-&gt;prev.good() &amp;&amp; me-&gt;options_.verbose) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;trkseg %s begin &quot;</span>, me-&gt;now.getTimeString().c_str());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// remember our location and put it in gTimeDict</span></div>
<div class="line">    gTimeDict[me-&gt;time] = me-&gt;now;</div>
<div class="line">    me-&gt;prev = me-&gt;now;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">&quot;trkseg&quot;</span>) == 0 &amp;&amp; me-&gt;options_.verbose) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s end\n&quot;</span>, me-&gt;now.getTimeString().c_str());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> charHandler(<span class="keywordtype">void</span>* userData, <span class="keyword">const</span> <span class="keywordtype">char</span>* s, <span class="keywordtype">int</span> len) {</div>
<div class="line">  <span class="keyword">auto</span> me = <span class="keyword">static_cast&lt;</span>UserData*<span class="keyword">&gt;</span>(userData);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (me-&gt;nTrkpt == 1) {</div>
<div class="line">    <span class="keywordtype">char</span> buffer[100];</div>
<div class="line">    <span class="keywordtype">int</span> l_max = 98;  <span class="comment">// lengthof(buffer) -2 ;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (me-&gt;bTime &amp;&amp; len &gt; 5) {</div>
<div class="line">      <span class="keywordflow">if</span> (len &lt; l_max) {</div>
<div class="line">        memcpy(buffer, s, len);</div>
<div class="line">        buffer[len] = 0;</div>
<div class="line">        <span class="keywordtype">char</span>* b = buffer;</div>
<div class="line">        <span class="keywordflow">while</span> (*b == <span class="charliteral">&#39; &#39;</span> &amp;&amp; b &lt; buffer + len)</div>
<div class="line">          b++;</div>
<div class="line">        me-&gt;xmlt = b;</div>
<div class="line">        me-&gt;time = parseTime(me-&gt;xmlt.c_str());</div>
<div class="line">        me-&gt;exift = getExifTime(me-&gt;time);</div>
<div class="line">      }</div>
<div class="line">      me-&gt;bTime = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (me-&gt;bEle &amp;&amp; len &gt; 2) {</div>
<div class="line">      <span class="keywordflow">if</span> (len &lt; l_max) {</div>
<div class="line">        memcpy(buffer, s, len);</div>
<div class="line">        buffer[len] = 0;</div>
<div class="line">        <span class="keywordtype">char</span>* b = buffer;</div>
<div class="line">        <span class="keywordflow">while</span> (*b == <span class="charliteral">&#39; &#39;</span> &amp;&amp; b &lt; buffer + len)</div>
<div class="line">          b++;</div>
<div class="line">        me-&gt;ele = atof(b);</div>
<div class="line">      }</div>
<div class="line">      me-&gt;bEle = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Time Functions</span></div>
<div class="line">time_t parseTime(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg, <span class="keywordtype">bool</span> bAdjust) {</div>
<div class="line">  time_t result = 0;</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// 559 rmills@rmills-imac:~/bin $ exiv2 -pa ~/R.jpg | grep -i date</span></div>
<div class="line">    <span class="comment">// Exif.Image.DateTime                          Ascii      20  2009:08:03 08:58:57</span></div>
<div class="line">    <span class="comment">// Exif.Photo.DateTimeOriginal                  Ascii      20  2009:08:03 08:58:57</span></div>
<div class="line">    <span class="comment">// Exif.Photo.DateTimeDigitized                 Ascii      20  2009:08:03 08:58:57</span></div>
<div class="line">    <span class="comment">// Exif.GPSInfo.GPSDateStamp                    Ascii      21  2009-08-03T15:58:57Z</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// &lt;time&gt;2012-07-14T17:33:16Z&lt;/time&gt;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (strstr(arg, <span class="stringliteral">&quot;:&quot;</span>) || strstr(arg, <span class="stringliteral">&quot;-&quot;</span>)) {</div>
<div class="line">      <span class="keywordtype">int</span> YY = 0, MM = 0, DD = 0, HH = 0, mm = 0, SS1 = 0;</div>
<div class="line">      <span class="keywordtype">char</span> a = 0, b = 0, c = 0, d = 0, e = 0;</div>
<div class="line">      sscanf(arg, <span class="stringliteral">&quot;%d%c%d%c%d%c%d%c%d%c%d&quot;</span>, &amp;YY, &amp;a, &amp;MM, &amp;b, &amp;DD, &amp;c, &amp;HH, &amp;d, &amp;mm, &amp;e, &amp;SS1);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">struct </span>tm T = {};</div>
<div class="line">      T.tm_min = mm;</div>
<div class="line">      T.tm_hour = HH;</div>
<div class="line">      T.tm_sec = SS1;</div>
<div class="line">      <span class="keywordflow">if</span> (bAdjust)</div>
<div class="line">        T.tm_sec -= Position::Adjust();</div>
<div class="line">      T.tm_year = YY - 1900;</div>
<div class="line">      T.tm_mon = MM - 1;</div>
<div class="line">      T.tm_mday = DD;</div>
<div class="line">      T.tm_isdst = -1;  <span class="comment">// determine value automatically (otherwise hour may shift)</span></div>
<div class="line">      result = mktime(&amp;T);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">  };</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// West of GMT is negative (PDT = Pacific Daylight = -07:00 == -25200 seconds</span></div>
<div class="line"><span class="keywordtype">int</span> timeZoneAdjust() {</div>
<div class="line">  [[maybe_unused]] time_t now = <a class="code hl_enumvalue" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>(<span class="keyword">nullptr</span>);</div>
<div class="line">  <span class="keywordtype">int</span> offset;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if defined(_WIN32)</span></div>
<div class="line">  TIME_ZONE_INFORMATION TimeZoneInfo;</div>
<div class="line">  GetTimeZoneInformation(&amp;TimeZoneInfo);</div>
<div class="line">  offset = -(((int)TimeZoneInfo.Bias + (int)TimeZoneInfo.DaylightBias) * 60);</div>
<div class="line"><span class="preprocessor">#elif defined(__CYGWIN__)</span></div>
<div class="line">  <span class="keyword">struct </span>tm lcopy = *localtime(&amp;now);</div>
<div class="line">  time_t gmt = timegm(&amp;lcopy);  <span class="comment">// timegm modifies lcopy</span></div>
<div class="line">  offset = (int)(((<span class="keywordtype">long</span> <span class="keywordtype">signed</span> <span class="keywordtype">int</span>)gmt) - ((<span class="keywordtype">long</span> <span class="keywordtype">signed</span> <span class="keywordtype">int</span>)now));</div>
<div class="line"><span class="preprocessor">#elif defined(OS_SOLARIS) || defined(__sun__)</span></div>
<div class="line">  <span class="keyword">struct </span>tm local = *localtime(&amp;now);</div>
<div class="line">  time_t local_tt = (int)mktime(&amp;local);</div>
<div class="line">  time_t time_gmt = (int)mktime(gmtime(&amp;now));</div>
<div class="line">  offset = time_gmt - local_tt;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <span class="keyword">struct </span>tm local = *localtime(&amp;now);</div>
<div class="line">  offset = local.tm_gmtoff;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if EXIV2_DEBUG_MESSAGES</span></div>
<div class="line">  <span class="keyword">struct </span>tm utc = *gmtime(&amp;now);</div>
<div class="line">  printf(<span class="stringliteral">&quot;utc  :  offset = %6d dst = %d time = %s&quot;</span>, 0, utc.tm_isdst, asctime(&amp;utc));</div>
<div class="line">  printf(<span class="stringliteral">&quot;local:  offset = %6d dst = %d time = %s&quot;</span>, offset, local.tm_isdst, asctime(&amp;local));</div>
<div class="line">  printf(<span class="stringliteral">&quot;timeZoneAdjust = %6d\n&quot;</span>, offset);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  <span class="keywordflow">return</span> offset;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string getExifTime(<span class="keyword">const</span> time_t t) {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> result[100];</div>
<div class="line">  strftime(result, <span class="keyword">sizeof</span>(result), <span class="stringliteral">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, localtime(&amp;t));</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string makePath(<span class="keyword">const</span> std::string&amp; dir, <span class="keyword">const</span> std::string&amp; file) {</div>
<div class="line">  <span class="keywordflow">return</span> dir + std::string(EXV_SEPARATOR_STR) + file;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// file utilities</span></div>
<div class="line"><span class="keywordtype">bool</span> readDir(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, Options&amp; options) {</div>
<div class="line">  <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line">  DWORD attrs = GetFileAttributes(path);</div>
<div class="line">  <span class="keywordtype">bool</span> bOKAttrs = attrs != INVALID_FILE_ATTRIBUTES;</div>
<div class="line">  <span class="keywordtype">bool</span> bIsDir = (attrs &amp; FILE_ATTRIBUTE_DIRECTORY) ? <span class="keyword">true</span> : false;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (bOKAttrs &amp;&amp; bIsDir) {</div>
<div class="line">    bResult = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> search[_MAX_PATH + 10];</div>
<div class="line">    strcpy_s(search, _MAX_PATH, path);</div>
<div class="line">    strcat_s(search, _MAX_PATH, <span class="stringliteral">&quot;\\*&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    WIN32_FIND_DATA ffd;</div>
<div class="line">    HANDLE hFind = FindFirstFile(search, &amp;ffd);</div>
<div class="line">    BOOL bGo = hFind != INVALID_HANDLE_VALUE;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (bGo) {</div>
<div class="line">      <span class="keywordflow">while</span> (bGo) {</div>
<div class="line">        <span class="keywordflow">if</span> (ffd.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY) {</div>
<div class="line">          <span class="comment">// _tprintf(TEXT(&quot;  %s   &lt;DIR&gt;\n&quot;), ffd.cFileName);</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          std::string pathName = makePath(path, ffd.cFileName);</div>
<div class="line">          <span class="keywordflow">if</span> (getFileType(pathName, options) == typeImage) {</div>
<div class="line">            gFiles.push_back(pathName);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        bGo = FindNextFile(hFind, &amp;ffd) != 0;</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// CloseHandle(hFind);</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  DIR* dir = opendir(path);</div>
<div class="line">  <span class="keywordflow">if</span> (dir != <span class="keyword">nullptr</span>) {</div>
<div class="line">    bResult = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keyword">struct </span>dirent* ent;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// print all the files and directories within directory</span></div>
<div class="line">    <span class="keywordflow">while</span> ((ent = readdir(dir)) != <span class="keyword">nullptr</span>) {</div>
<div class="line">      std::string pathName = makePath(path, ent-&gt;d_name);</div>
<div class="line">      <span class="keyword">struct </span>stat buf;</div>
<div class="line">      lstat(path, &amp;buf);</div>
<div class="line">      <span class="keywordflow">if</span> (ent-&gt;d_name[0] != <span class="charliteral">&#39;.&#39;</span>) {</div>
<div class="line">        <span class="comment">// printf(&quot;reading %s =&gt; %s\n&quot;,ent-&gt;d_name,pathName.c_str());</span></div>
<div class="line">        <span class="keywordflow">if</span> (getFileType(pathName, options) == typeImage) {</div>
<div class="line">          gFiles.push_back(pathName);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    closedir(dir);</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  <span class="keywordflow">return</span> bResult;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> sip(FILE* f, <span class="keywordtype">char</span>* buffer, <span class="keywordtype">size_t</span> max_len, <span class="keywordtype">size_t</span> len) {</div>
<div class="line">  <span class="keywordflow">while</span> (!feof(f) &amp;&amp; len &lt; max_len &amp;&amp; buffer[len - 1] != <span class="charliteral">&#39;&gt;&#39;</span>)</div>
<div class="line">    buffer[len++] = fgetc(f);</div>
<div class="line">  <span class="keywordflow">return</span> len;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> readXML(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, Options&amp; options) {</div>
<div class="line">  FILE* f = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">  XML_Parser parser = XML_ParserCreate(<span class="keyword">nullptr</span>);</div>
<div class="line">  <span class="keywordtype">bool</span> bResult = f &amp;&amp; parser;</div>
<div class="line">  <span class="keywordflow">if</span> (bResult) {</div>
<div class="line">    <span class="keywordtype">char</span> buffer[8 * 1024];</div>
<div class="line">    UserData me(options);</div>
<div class="line"> </div>
<div class="line">    XML_SetUserData(parser, &amp;me);</div>
<div class="line">    XML_SetElementHandler(parser, startElement, endElement);</div>
<div class="line">    XML_SetCharacterDataHandler(parser, charHandler);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// a little sip at the data</span></div>
<div class="line">    <span class="keywordtype">size_t</span> len = fread(buffer, 1, <span class="keyword">sizeof</span>(buffer) - 100, f);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* lead = <span class="stringliteral">&quot;&lt;?xml&quot;</span>;</div>
<div class="line">    bResult = strncmp(lead, buffer, strlen(lead)) == 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// swallow it</span></div>
<div class="line">    <span class="keywordflow">if</span> (bResult) {</div>
<div class="line">      len = sip(f, buffer, <span class="keyword">sizeof</span> buffer, len);</div>
<div class="line">      bResult = XML_Parse(parser, buffer, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(len), len == 0) == XML_STATUS_OK;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// drink the rest of the file</span></div>
<div class="line">    <span class="keywordflow">while</span> (bResult &amp;&amp; len != 0) {</div>
<div class="line">      len = fread(buffer, 1, <span class="keyword">sizeof</span>(buffer) - 100, f);</div>
<div class="line">      len = sip(f, buffer, <span class="keyword">sizeof</span> buffer, len);</div>
<div class="line">      bResult = XML_Parse(parser, buffer, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(len), len == 0) == XML_STATUS_OK;</div>
<div class="line">    };</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (f)</div>
<div class="line">    fclose(f);</div>
<div class="line">  <span class="keywordflow">if</span> (parser)</div>
<div class="line">    XML_ParserFree(parser);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> bResult;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> readImage(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, Options&amp; <span class="comment">/* options */</span>) {</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceExiv2.html">Exiv2</a>;</div>
<div class="line">  <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <a class="code hl_typedef" href="classExiv2_1_1Image.html#ae19135d23c1bfb24aa08d2704cc59702">Image::UniquePtr</a> image = <a class="code hl_function" href="classExiv2_1_1ImageFactory.html#a3133e16ff4725e79b2ca194372d6aed6">ImageFactory::open</a>(path);</div>
<div class="line">    <span class="keywordflow">if</span> (image.get()) {</div>
<div class="line">      image-&gt;readMetadata();</div>
<div class="line">      <a id="_a0" name="_a0"></a><a class="code hl_class" href="classExiv2_1_1ExifData.html">ExifData</a>&amp; exifData = image-&gt;exifData();</div>
<div class="line">      bResult = !exifData.<a id="a1" name="a1"></a><a class="code hl_function" href="classExiv2_1_1ExifData.html#a0627816364585c0579cba89e6e287d74">empty</a>();</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">  };</div>
<div class="line">  <span class="keywordflow">return</span> bResult;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">time_t readImageTime(<span class="keyword">const</span> std::string&amp; path, std::string* pS = <span class="keyword">nullptr</span>) {</div>
<div class="line">  <span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceExiv2.html">Exiv2</a>;</div>
<div class="line"> </div>
<div class="line">  time_t result = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* dateStrings[] = {<span class="stringliteral">&quot;Exif.Photo.DateTimeOriginal&quot;</span>, <span class="stringliteral">&quot;Exif.Photo.DateTimeDigitized&quot;</span>, <span class="stringliteral">&quot;Exif.Image.DateTime&quot;</span>,</div>
<div class="line">                               <span class="keyword">nullptr</span>};</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; !result &amp;&amp; dateStrings[i]; i++) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* dateString = dateStrings[i];</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">      <a class="code hl_typedef" href="classExiv2_1_1Image.html#ae19135d23c1bfb24aa08d2704cc59702">Image::UniquePtr</a> image = <a class="code hl_function" href="classExiv2_1_1ImageFactory.html#a3133e16ff4725e79b2ca194372d6aed6">ImageFactory::open</a>(path);</div>
<div class="line">      <span class="keywordflow">if</span> (image.get()) {</div>
<div class="line">        image-&gt;readMetadata();</div>
<div class="line">        <a class="code hl_class" href="classExiv2_1_1ExifData.html">ExifData</a>&amp; exifData = image-&gt;exifData();</div>
<div class="line">        <span class="comment">//  printf(&quot;%s =&gt; %s\n&quot;,dateString, exifData[dateString].toString().c_str());</span></div>
<div class="line">        result = parseTime(exifData[dateString].toString().c_str(), <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (result &amp;&amp; pS)</div>
<div class="line">          *pS = exifData[dateString].toString();</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">    };</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> sina(<span class="keyword">const</span> <span class="keywordtype">char</span>* s, <span class="keyword">const</span> <span class="keywordtype">char</span>** a) {</div>
<div class="line">  <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line">  <span class="keywordtype">int</span> i = 0;</div>
<div class="line">  <span class="keywordflow">while</span> (*s == <span class="charliteral">&#39;-&#39;</span>)</div>
<div class="line">    s++;</div>
<div class="line">  <span class="keywordflow">while</span> (!bResult &amp;&amp; a[i]) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* A = a[i];</div>
<div class="line">    <span class="keywordflow">while</span> (*A == <span class="charliteral">&#39;-&#39;</span>)</div>
<div class="line">      A++;</div>
<div class="line">    bResult = stricmp(s, A) == 0;</div>
<div class="line">    i++;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> bResult;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceExiv2.html#a7a0cf82083985b5e1a9d7ae80c3e7145">readFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keyword">const</span> Options&amp; <span class="comment">/* options */</span>) {</div>
<div class="line">  FILE* f = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">  <span class="keywordtype">int</span> nResult = f ? typeFile : typeUnknown;</div>
<div class="line">  <span class="keywordflow">if</span> (f) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* ext = strstr(path, <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (ext) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span>* docs[] = {<span class="stringliteral">&quot;.doc&quot;</span>, <span class="stringliteral">&quot;.txt&quot;</span>, <span class="keyword">nullptr</span>};</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span>* code[] = {<span class="stringliteral">&quot;.cpp&quot;</span>, <span class="stringliteral">&quot;.h&quot;</span>, <span class="stringliteral">&quot;.pl&quot;</span>, <span class="stringliteral">&quot;.py&quot;</span>, <span class="stringliteral">&quot;.pyc&quot;</span>, <span class="keyword">nullptr</span>};</div>
<div class="line">      <span class="keywordflow">if</span> (sina(ext, docs))</div>
<div class="line">        nResult = typeDoc;</div>
<div class="line">      <span class="keywordflow">if</span> (sina(ext, code))</div>
<div class="line">        nResult = typeCode;</div>
<div class="line">    }</div>
<div class="line">    fclose(f);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> nResult;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Position* searchTimeDict(TimeDict_t&amp; td, <span class="keyword">const</span> time_t&amp; <a class="code hl_enumvalue" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>, <span class="keywordtype">long</span> <span class="keywordtype">long</span> delta) {</div>
<div class="line">  Position* result = <span class="keyword">nullptr</span>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; !result &amp;&amp; t &lt; delta; t++) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; !result &amp;&amp; x &lt; 2; x++) {</div>
<div class="line">      <span class="keywordtype">int</span> T = t * ((x == 0) ? -1 : 1);</div>
<div class="line">      <span class="keywordflow">if</span> (td.count(<a class="code hl_enumvalue" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a> + T)) {</div>
<div class="line">        result = &amp;td[<a class="code hl_enumvalue" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a> + T];</div>
<div class="line">        result-&gt;delta(T);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> getFileType(std::string&amp; path, Options&amp; options) {</div>
<div class="line">  <span class="keywordflow">return</span> getFileType(path.c_str(), options);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">int</span> getFileType(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, Options&amp; options) {</div>
<div class="line">  <span class="keywordflow">return</span> readXML(path, options)     ? typeXML</div>
<div class="line">         : readDir(path, options)   ? typeDirectory</div>
<div class="line">         : readImage(path, options) ? typeImage</div>
<div class="line">                                    : <a class="code hl_function" href="namespaceExiv2.html#a7a0cf82083985b5e1a9d7ae80c3e7145">readFile</a>(path, options);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceExiv2.html#a2019ba1f82453a4f43d24d12fb63e3e7">version</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* program) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;%s: %s %s\n&quot;</span>, program, __DATE__, __TIME__);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> help(<span class="keyword">const</span> <span class="keywordtype">char</span>* program, <span class="keywordtype">char</span> <span class="keyword">const</span>* words[], <span class="keywordtype">int</span> nWords, <span class="keywordtype">bool</span> <span class="comment">/*bVerbose*/</span>) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;usage: %s &quot;</span>, program);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nWords; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (words[i])</div>
<div class="line">      printf(<span class="stringliteral">&quot;%c-%s%s&quot;</span>, i ? <span class="charliteral">&#39;|&#39;</span> : <span class="charliteral">&#39;{&#39;</span>, words[i], i &gt; (-kwNOVALUE) ? <span class="stringliteral">&quot; value&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  printf(<span class="stringliteral">&quot;}+ path+\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> compare(<span class="keyword">const</span> <span class="keywordtype">char</span>* a, <span class="keyword">const</span> <span class="keywordtype">char</span>* b) {</div>
<div class="line">  <span class="keywordtype">int</span> result = *a &amp;&amp; *b;</div>
<div class="line">  <span class="keywordflow">while</span> (result &amp;&amp; *a &amp;&amp; *b) {</div>
<div class="line">    <span class="keywordtype">char</span> A = *a++;</div>
<div class="line">    <span class="keywordtype">char</span> B = *b++;</div>
<div class="line">    result = tolower(A) == tolower(B);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceExiv2.html#a130b1d28ffc46d64bef4663f2872cd91">find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg, <span class="keywordtype">char</span> <span class="keyword">const</span>* words[], <span class="keywordtype">int</span> nWords) {</div>
<div class="line">  <span class="keywordflow">if</span> (arg[0] != <span class="charliteral">&#39;-&#39;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> kwSYNTAX;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> result = 0;</div>
<div class="line">  <span class="keywordtype">int</span> count = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nWords; i++) {</div>
<div class="line">    <span class="keywordtype">int</span> j = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (arg[j] == <span class="charliteral">&#39;-&#39;</span>)</div>
<div class="line">      j++;</div>
<div class="line">    <span class="keywordflow">if</span> (::compare(arg + j, words[i])) {</div>
<div class="line">      result = i;</div>
<div class="line">      count++;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> count == 1 ? result : kwSYNTAX;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> parseTZ(<span class="keyword">const</span> <span class="keywordtype">char</span>* adjust) {</div>
<div class="line">  <span class="keywordtype">int</span> h = 0;</div>
<div class="line">  <span class="keywordtype">int</span> m = 0;</div>
<div class="line">  <span class="keywordtype">char</span> c = 0;</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    sscanf(adjust, <span class="stringliteral">&quot;%d%c%d&quot;</span>, &amp;h, &amp;c, &amp;m);</div>
<div class="line">  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> (3600 * h) + (60 * m);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> mySort(<span class="keyword">const</span> std::string&amp; a, <span class="keyword">const</span> std::string&amp; b) {</div>
<div class="line">  time_t A = readImageTime(a);</div>
<div class="line">  time_t B = readImageTime(b);</div>
<div class="line">  <span class="keywordflow">return</span> (A &lt; B);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line">  <a id="a2" name="a2"></a><a class="code hl_function" href="classExiv2_1_1XmpParser.html#a68b3686f99e86eb54e70b20dc3a9f936">Exiv2::XmpParser::initialize</a>();</div>
<div class="line">  ::atexit(<a class="code hl_function" href="classExiv2_1_1XmpParser.html#ae6c0f4a9eeef2aed456346a206981b4c">Exiv2::XmpParser::terminate</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> result = 0;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* program = argv[0];</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* types[typeMax];</div>
<div class="line">  types[typeUnknown] = <span class="stringliteral">&quot;unknown&quot;</span>;</div>
<div class="line">  types[typeDirectory] = <span class="stringliteral">&quot;directory&quot;</span>;</div>
<div class="line">  types[typeImage] = <span class="stringliteral">&quot;image&quot;</span>;</div>
<div class="line">  types[typeXML] = <span class="stringliteral">&quot;xml&quot;</span>;</div>
<div class="line">  types[typeDoc] = <span class="stringliteral">&quot;doc&quot;</span>;</div>
<div class="line">  types[typeCode] = <span class="stringliteral">&quot;code&quot;</span>;</div>
<div class="line">  types[typeFile] = <span class="stringliteral">&quot;file&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">char</span> <span class="keyword">const</span>* keywords[kwMAX] = {};</div>
<div class="line">  keywords[kwHELP] = <span class="stringliteral">&quot;help&quot;</span>;</div>
<div class="line">  keywords[kwVERSION] = <span class="stringliteral">&quot;version&quot;</span>;</div>
<div class="line">  keywords[kwVERBOSE] = <span class="stringliteral">&quot;verbose&quot;</span>;</div>
<div class="line">  keywords[kwDRYRUN] = <span class="stringliteral">&quot;dryrun&quot;</span>;</div>
<div class="line">  keywords[kwASCII] = <span class="stringliteral">&quot;ascii&quot;</span>;</div>
<div class="line">  keywords[kwDST] = <span class="stringliteral">&quot;dst&quot;</span>;</div>
<div class="line">  keywords[kwADJUST] = <span class="stringliteral">&quot;adjust&quot;</span>;</div>
<div class="line">  keywords[kwTZ] = <span class="stringliteral">&quot;tz&quot;</span>;</div>
<div class="line">  keywords[kwDELTA] = <span class="stringliteral">&quot;delta&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  std::map&lt;std::string, std::string&gt; shorts;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-?&quot;</span>] = <span class="stringliteral">&quot;-help&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-h&quot;</span>] = <span class="stringliteral">&quot;-help&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-v&quot;</span>] = <span class="stringliteral">&quot;-verbose&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-V&quot;</span>] = <span class="stringliteral">&quot;-version&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-d&quot;</span>] = <span class="stringliteral">&quot;-dst&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-a&quot;</span>] = <span class="stringliteral">&quot;-adjust&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-t&quot;</span>] = <span class="stringliteral">&quot;-tz&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-D&quot;</span>] = <span class="stringliteral">&quot;-delta&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-s&quot;</span>] = <span class="stringliteral">&quot;-delta&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-X&quot;</span>] = <span class="stringliteral">&quot;-dryrun&quot;</span>;</div>
<div class="line">  shorts[<span class="stringliteral">&quot;-A&quot;</span>] = <span class="stringliteral">&quot;-ascii&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  Options options;</div>
<div class="line">  options.help = sina(keywords[kwHELP], argv) || argc &lt; 2;</div>
<div class="line">  options.verbose = sina(keywords[kwVERBOSE], argv);</div>
<div class="line">  options.dryrun = sina(keywords[kwDRYRUN], argv);</div>
<div class="line">  options.version = sina(keywords[kwVERSION], argv);</div>
<div class="line">  options.dst = sina(keywords[kwDST], argv);</div>
<div class="line">  options.ascii = sina(keywords[kwASCII], argv);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; !result &amp;&amp; i &lt; argc; i++) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* arg = argv[i++];</div>
<div class="line">    <span class="keywordflow">if</span> (shorts.count(arg))</div>
<div class="line">      arg = shorts[arg].c_str();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* value = argv[i];</div>
<div class="line">    <span class="keywordtype">int</span> ivalue = ::atoi(value ? value : <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> key = <a class="code hl_function" href="namespaceExiv2.html#a130b1d28ffc46d64bef4663f2872cd91">::find</a>(arg, keywords, kwMAX);</div>
<div class="line">    <span class="keywordtype">int</span> needv = key &lt; kwMAX &amp;&amp; key &gt; (-kwNOVALUE);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!needv)</div>
<div class="line">      i--;</div>
<div class="line">    <span class="keywordflow">if</span> (needv &amp;&amp; !value)</div>
<div class="line">      key = kwNEEDVALUE;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (key) {</div>
<div class="line">      <span class="keywordflow">case</span> kwDST:</div>
<div class="line">        options.dst = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwHELP:</div>
<div class="line">        options.help = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwVERSION:</div>
<div class="line">        options.version = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwDRYRUN:</div>
<div class="line">        options.dryrun = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwVERBOSE:</div>
<div class="line">        options.verbose = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwASCII:</div>
<div class="line">        options.ascii = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwTZ:</div>
<div class="line">        Position::tz_ = parseTZ(value);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwADJUST:</div>
<div class="line">        Position::adjust_ = ivalue;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwDELTA:</div>
<div class="line">        Position::deltaMax_ = ivalue;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwNEEDVALUE:</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;error: %s requires a value\n&quot;</span>, arg);</div>
<div class="line">        result = resultSyntaxError;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> kwSYNTAX:</div>
<div class="line">      <span class="keywordflow">default</span>: {</div>
<div class="line">        <span class="keywordtype">int</span> type = getFileType(arg, options);</div>
<div class="line">        <span class="keywordflow">if</span> (options.verbose)</div>
<div class="line">          printf(<span class="stringliteral">&quot;%s %s &quot;</span>, arg, types[type]);</div>
<div class="line">        <span class="keywordflow">if</span> (type == typeImage) {</div>
<div class="line">          time_t t = readImageTime(std::string(arg));</div>
<div class="line">          <span class="keyword">auto</span> p = fs::absolute(fs::path(arg));</div>
<div class="line">          std::string path = p.string();</div>
<div class="line">          <span class="keywordflow">if</span> (t &amp;&amp; !path.empty()) {</div>
<div class="line">            <span class="keywordflow">if</span> (options.verbose)</div>
<div class="line">              printf(<span class="stringliteral">&quot;%s %ld %s&quot;</span>, path.c_str(), <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(t), asctime(localtime(&amp;t)));</div>
<div class="line">            gFiles.push_back(path);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (type == typeUnknown) {</div>
<div class="line">          fprintf(stderr, <span class="stringliteral">&quot;error: illegal syntax %s\n&quot;</span>, arg);</div>
<div class="line">          result = resultSyntaxError;</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (options.help)</div>
<div class="line">    ::help(program, keywords, kwMAX, options.verbose);</div>
<div class="line">  <span class="keywordflow">if</span> (options.version)</div>
<div class="line">    <a class="code hl_function" href="namespaceExiv2.html#a2019ba1f82453a4f43d24d12fb63e3e7">::version</a>(program);</div>
<div class="line">  gDeg = options.ascii ? <span class="stringliteral">&quot;deg&quot;</span> : <span class="stringliteral">&quot;°&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!result) {</div>
<div class="line">    sort(gFiles.begin(), gFiles.end(), mySort);</div>
<div class="line">    <span class="keywordflow">if</span> (options.dst)</div>
<div class="line">      Position::dst_ = 3600;</div>
<div class="line">    <span class="keywordflow">if</span> (options.verbose) {</div>
<div class="line">      <span class="keywordtype">int</span> t = Position::tz();</div>
<div class="line">      <span class="keywordtype">int</span> d = Position::dst();</div>
<div class="line">      <span class="keywordtype">int</span> a = Position::adjust();</div>
<div class="line">      <span class="keywordtype">int</span> A = Position::Adjust();</div>
<div class="line">      <span class="keywordtype">int</span> s = A;</div>
<div class="line">      <span class="keywordtype">int</span> h = s / 3600;</div>
<div class="line">      s -= h * 3600;</div>
<div class="line">      s = <a class="code hl_function" href="namespaceSafe.html#aaeb8f2b9981d065ea3aa58429cfbfee4">abs</a>(s);</div>
<div class="line">      <span class="keywordtype">int</span> m = s / 60;</div>
<div class="line">      s -= m * 60;</div>
<div class="line">      printf(<span class="stringliteral">&quot;tz,dst,adjust = %d,%d,%d total = %dsecs (= %d:%d:%d)\n&quot;</span>, t, d, a, A, h, m, s);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">            if ( options.verbose ) {</span></div>
<div class="line"><span class="comment">                printf(&quot;Time Dictionary\n&quot;);</span></div>
<div class="line"><span class="comment">                for ( TimeDict_i it = gTimeDict.begin() ;  it != gTimeDict.end() ; it++ ) {</span></div>
<div class="line"><span class="comment">                    std::string sTime = getExifTime(it-&gt;first);</span></div>
<div class="line"><span class="comment">                    Position*   pPos  = &amp;it-&gt;second;</span></div>
<div class="line"><span class="comment">                    std::string sPos  = Position::toExifString(pPos-&gt;lat(),false,true)</span></div>
<div class="line"><span class="comment">                                      + &quot; &quot;</span></div>
<div class="line"><span class="comment">                                      + Position::toExifString(pPos-&gt;lon(),false,true)</span></div>
<div class="line"><span class="comment">                                      ;</span></div>
<div class="line"><span class="comment">                    printf(&quot;%s %s\n&quot;,sTime.c_str(), sPos.c_str());</span></div>
<div class="line"><span class="comment">                }</span></div>
<div class="line"><span class="comment">            }</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; path : gFiles) {</div>
<div class="line">      std::string stamp;</div>
<div class="line">      <span class="keywordflow">try</span> {</div>
<div class="line">        time_t t = readImageTime(path, &amp;stamp);</div>
<div class="line">        Position* pPos = searchTimeDict(gTimeDict, t, Position::deltaMax_);</div>
<div class="line">        <a class="code hl_typedef" href="classExiv2_1_1Image.html#ae19135d23c1bfb24aa08d2704cc59702">Exiv2::Image::UniquePtr</a> image = <a id="a3" name="a3"></a><a class="code hl_function" href="classExiv2_1_1ImageFactory.html#a3133e16ff4725e79b2ca194372d6aed6">Exiv2::ImageFactory::open</a>(path);</div>
<div class="line">        <span class="keywordflow">if</span> (image.get()) {</div>
<div class="line">          image-&gt;readMetadata();</div>
<div class="line">          <a class="code hl_class" href="classExiv2_1_1ExifData.html">Exiv2::ExifData</a>&amp; exifData = image-&gt;exifData();</div>
<div class="line">          <span class="keywordflow">if</span> (pPos) {</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSProcessingMethod&quot;</span>] = <span class="stringliteral">&quot;charset=Ascii HYBRID-FIX&quot;</span>;</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSVersionID&quot;</span>] = <span class="stringliteral">&quot;2 2 0 0&quot;</span>;</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSMapDatum&quot;</span>] = <span class="stringliteral">&quot;WGS-84&quot;</span>;</div>
<div class="line"> </div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLatitude&quot;</span>] = Position::toExifString(pPos-&gt;lat(), <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLongitude&quot;</span>] = Position::toExifString(pPos-&gt;lon(), <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSAltitude&quot;</span>] = Position::toExifString(pPos-&gt;ele());</div>
<div class="line"> </div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSAltitudeRef&quot;</span>] = pPos-&gt;ele() &lt; 0.0 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>;</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLatitudeRef&quot;</span>] = pPos-&gt;lat() &gt; 0 ? <span class="stringliteral">&quot;N&quot;</span> : <span class="stringliteral">&quot;S&quot;</span>;</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLongitudeRef&quot;</span>] = pPos-&gt;lon() &gt; 0 ? <span class="stringliteral">&quot;E&quot;</span> : <span class="stringliteral">&quot;W&quot;</span>;</div>
<div class="line"> </div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSDateStamp&quot;</span>] = stamp;</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSTimeStamp&quot;</span>] = Position::toExifTimeStamp(stamp);</div>
<div class="line">            exifData[<span class="stringliteral">&quot;Exif.Image.GPSTag&quot;</span>] = 4908;</div>
<div class="line"> </div>
<div class="line">            printf(<span class="stringliteral">&quot;%s %s % 2d\n&quot;</span>, path.c_str(), pPos-&gt;toString().c_str(), pPos-&gt;delta());</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            printf(<span class="stringliteral">&quot;%s *** not in time dict ***\n&quot;</span>, path.c_str());</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">if</span> (!options.dryrun)</div>
<div class="line">            image-&gt;writeMetadata();</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">      };</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// That&#39;s all Folks!</span></div>
<div class="ttc" id="aclassExiv2_1_1ExifData_html"><div class="ttname"><a href="classExiv2_1_1ExifData.html">Exiv2::ExifData</a></div><div class="ttdoc">A container for Exif data. This is a top-level class of the Exiv2 library. The container holds Exifda...</div><div class="ttdef"><b>Definition</b> exif.hpp:379</div></div>
<div class="ttc" id="aclassExiv2_1_1ExifData_html_a0627816364585c0579cba89e6e287d74"><div class="ttname"><a href="classExiv2_1_1ExifData.html#a0627816364585c0579cba89e6e287d74">Exiv2::ExifData::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Return true if there is no Exif metadata.</div><div class="ttdef"><b>Definition</b> exif.hpp:465</div></div>
<div class="ttc" id="aclassExiv2_1_1ImageFactory_html_a3133e16ff4725e79b2ca194372d6aed6"><div class="ttname"><a href="classExiv2_1_1ImageFactory.html#a3133e16ff4725e79b2ca194372d6aed6">Exiv2::ImageFactory::open</a></div><div class="ttdeci">static Image::UniquePtr open(const std::string &amp;path, bool useCurl=true)</div><div class="ttdoc">Create an Image subclass of the appropriate type by reading the specified file. Image type is derived...</div><div class="ttdef"><b>Definition</b> image.cpp:804</div></div>
<div class="ttc" id="aclassExiv2_1_1Image_html_ae19135d23c1bfb24aa08d2704cc59702"><div class="ttname"><a href="classExiv2_1_1Image.html#ae19135d23c1bfb24aa08d2704cc59702">Exiv2::Image::UniquePtr</a></div><div class="ttdeci">std::unique_ptr&lt; Image &gt; UniquePtr</div><div class="ttdoc">Image auto_ptr type.</div><div class="ttdef"><b>Definition</b> image.hpp:53</div></div>
<div class="ttc" id="aclassExiv2_1_1XmpParser_html_a68b3686f99e86eb54e70b20dc3a9f936"><div class="ttname"><a href="classExiv2_1_1XmpParser.html#a68b3686f99e86eb54e70b20dc3a9f936">Exiv2::XmpParser::initialize</a></div><div class="ttdeci">static bool initialize(XmpParser::XmpLockFct xmpLockFct=nullptr, void *pLockData=nullptr)</div><div class="ttdoc">Initialize the XMP Toolkit.</div><div class="ttdef"><b>Definition</b> xmp.cpp:568</div></div>
<div class="ttc" id="aclassExiv2_1_1XmpParser_html_ae6c0f4a9eeef2aed456346a206981b4c"><div class="ttname"><a href="classExiv2_1_1XmpParser.html#ae6c0f4a9eeef2aed456346a206981b4c">Exiv2::XmpParser::terminate</a></div><div class="ttdeci">static void terminate()</div><div class="ttdoc">Terminate the XMP Toolkit and unregister custom namespaces.</div><div class="ttdef"><b>Definition</b> xmp.cpp:623</div></div>
<div class="ttc" id="anamespaceExiv2_1_1Internal_html_ad1028d0d234befbd6cf52b949236db8f"><div class="ttname"><a href="namespaceExiv2_1_1Internal.html#ad1028d0d234befbd6cf52b949236db8f">Exiv2::Internal::indent</a></div><div class="ttdeci">std::string indent(size_t i)</div><div class="ttdoc">indent output for kpsRecursive in printStructure() .</div><div class="ttdef"><b>Definition</b> image_int.cpp:38</div></div>
<div class="ttc" id="anamespaceExiv2_html"><div class="ttname"><a href="namespaceExiv2.html">Exiv2</a></div><div class="ttdoc">Class CrwImage to access Canon CRW images.  References:  The Canon RAW (CRW) File Format by Phil Harv...</div><div class="ttdef"><b>Definition</b> asfvideo.hpp:15</div></div>
<div class="ttc" id="anamespaceExiv2_html_a130b1d28ffc46d64bef4663f2872cd91"><div class="ttname"><a href="namespaceExiv2.html#a130b1d28ffc46d64bef4663f2872cd91">Exiv2::find</a></div><div class="ttdeci">const T * find(T(&amp;src)[N], const K &amp;key)</div><div class="ttdoc">Find an element that matches key in the array src.</div><div class="ttdef"><b>Definition</b> types.hpp:449</div></div>
<div class="ttc" id="anamespaceExiv2_html_a2019ba1f82453a4f43d24d12fb63e3e7"><div class="ttname"><a href="namespaceExiv2.html#a2019ba1f82453a4f43d24d12fb63e3e7">Exiv2::version</a></div><div class="ttdeci">EXIV2API const char * version()</div><div class="ttdoc">Return the version of Exiv2 as &quot;C&quot; string eg &quot;0.27.0.2&quot;.</div><div class="ttdef"><b>Definition</b> version.cpp:82</div></div>
<div class="ttc" id="anamespaceExiv2_html_a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6"><div class="ttname"><a href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">Exiv2::time</a></div><div class="ttdeci">@ time</div><div class="ttdoc">IPTC time type.</div><div class="ttdef"><b>Definition</b> types.hpp:89</div></div>
<div class="ttc" id="anamespaceExiv2_html_a7a0cf82083985b5e1a9d7ae80c3e7145"><div class="ttname"><a href="namespaceExiv2.html#a7a0cf82083985b5e1a9d7ae80c3e7145">Exiv2::readFile</a></div><div class="ttdeci">EXIV2API DataBuf readFile(const std::string &amp;path)</div><div class="ttdoc">Read file path into a DataBuf, which is returned.</div><div class="ttdef"><b>Definition</b> basicio.cpp:1730</div></div>
<div class="ttc" id="anamespaceSafe_html_aaeb8f2b9981d065ea3aa58429cfbfee4"><div class="ttname"><a href="namespaceSafe.html#aaeb8f2b9981d065ea3aa58429cfbfee4">Safe::abs</a></div><div class="ttdeci">T abs(T num) noexcept</div><div class="ttdoc">Calculates the absolute value of a number without producing negative values.</div><div class="ttdef"><b>Definition</b> safe_op.hpp:188</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 21 2025 16:42:19 for Exiv2 by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
